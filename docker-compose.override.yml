version: '3.8'

services:
  backend:
    volumes:
      - ./backend:/app
      - static_volume:/app/staticfiles
      - media_volume:/app/media
      - ./data:/app/data
    environment:
      - DEBUG=False
      - DJANGO_SETTINGS_MODULE=config.settings.production
      - EMAIL_HOST=smtp.lolipop.jp
      - EMAIL_PORT=465
      - EMAIL_USE_SSL=True
      - EMAIL_USE_TLS=False
      - EMAIL_HOST_USER=info@oz-a.jp
      - EMAIL_HOST_PASSWORD=Z_uOO_9f7-YH_h34
      - DEFAULT_FROM_EMAIL=info@oz-a.jp
      - FRONTEND_URL=http://localhost:3000

  # frontend-customer: 開発モード（ホットリロード有効）
  frontend-customer:
    image: node:18-alpine
    working_dir: /app
    command: sh -c "npm install --legacy-peer-deps && npm run dev"
    volumes:
      - ./frontend/customer:/app
      - frontend_customer_node_modules:/app/node_modules
      - frontend_customer_next:/app/.next
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1

volumes:
  frontend_customer_node_modules:
  frontend_customer_next:
